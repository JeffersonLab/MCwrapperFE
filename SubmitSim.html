<html>
    <head>
        <title>MCwrapper Submit Form by Thomas Britton</title>
    </head>
    <script src="./js/jquery-3.3.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="./css/animations.css"/>
    <link rel="stylesheet" type="text/css" href="./css/Form.css"/>
<body>
        <div id="newsstand">
            </div>
<div id="Form-pane">
    <div id="Form-header">

        <div id="links">
                <nav role="navigation">
                        <div id="menuToggle">
                          <!--
                          A fake / hidden checkbox is used as click reciever,
                          so you can use the :checked selector on it.
                          -->
                          <input type="checkbox" style="height:60px"/>

                          <!--
                          Some spans to act as a hamburger.

                          They are acting like a real hamburger,
                          not that McDonalds stuff.
                          -->
                          Menu
                          <span></span>
                          <span></span>
                          <span></span>

                          <!--
                          Too bad the menu has to be inside of the button
                          but hey, it's pure CSS magic.
                          -->
                          <ul id="menu">
                            <a href="https://halldweb.jlab.org/gluex_sim/Dashboard.html"><li>Dashboard</li></a>
                            <a href="https://halldweb.jlab.org/gluex_sim/Records.html"><li>Records</li></a>
                            <a href="https://github.com/JeffersonLab/gluex_MCwrapper"><li>Github Repository</li></a>
                            <a href="https://www.overleaf.com/read/bqynmnwstzfx"><li>Documentation</li></a>
                            <a href="mailto: tbritton@jlab.org;ppauli@jlab.org"><li>Contact Me</li></a>
                          </ul>
                        </div>
                      </nav>
        </div>
        <div id="logoh">
        <img src="./imgs/logo.png" id="logo" class="logo">
        <img src="./imgs/gluexlogo.png" id="explogo" class="explogo">
        </div>

        <br>



    </div>
        <form id="Form" action="./php/WrapperForm.php">
            <input type="hidden" value="-1" id="prefill" name="prefill">
            <input type="hidden" value="0" id="mod" name="mod">
            <input type="hidden" value="" id="blockname" name="blockname">
            <input type="hidden" value=1 id="wall" name="wall">
            <div id="expSelector" class="switch-field">
                    <div class="switch-title">Experiment</div>
                    <input type="radio" id="GlueX" name="exp" value="GlueX" onclick="ChangeLogo('GlueX');MakeGlueXBeamTimeSelector();MakeCheckButton();alphabetizeslector()" checked/>
                    <label for="GlueX">GlueX</label>
                    <input type="radio" id="CPP" name="exp" value="CPP" onclick="ChangeLogo('CPP');MakeCPPBeamTimeSelector();MakeCPPForm();MakeCheckButton();alphabetizeslector()" />
                    <label for="CPP">CPP</label>
                    <input type="radio" id="JEF" name="exp" value="JEF" onclick="ChangeLogo('JEF');MakeJEFBeamTimeSelector();MakeJEFForm();MakeCheckButton();alphabetizeslector()" />
                    <label for="JEF">JEF</label>
                    <!--<input type="radio" id="switch_3_right" name="switch_3" value="no" />
                    <label for="switch_3_right">Three</label>-->
            </div>

            <input type="hidden" value="" id="maxrunrange" name="maxrunrange">
            <input type="hidden" value="" id="savedrcdbquery" name="savedrcdbquery">
            <div id="beamtimeSelector">
                
            </div>
            <br>
            <br>
            <div id="personal">


                    <label for="uname">Name</label>
                    <input type="text" id="uname" name="username" placeholder="Your name...">
                    <br>
                    <br>
                    <label for="email">Email</label>
                    <input type="text" id="email" name="useremail" placeholder="e.g. me@jlab.org" required>
            </div>
            <br>
            <br>
            <div id="expform" style="width:100%;">

            </div>
            <div id="submitbutton">
                    <label for="wallet" id="balance" class="hidden">Balance </label>
                    <input type="number" min="0" id="spend" name="spend" step=".001" class="hidden">
            </div>

        </form>

</div>
<div id="Info-pane">
        <object type="text/html" id="setpreview" data="https://halldweb.jlab.org/halld_versions/recon-2017_01-ver03_16.xml"
        style="width:100%; height:100%; margin:1%; align:center; position:relative; display:block">
</object>
</div>

</body>
<script>
    var urlvals;
    news_lock=false;
    setInterval(function(){
            if(!news_lock)
                return

            news_lock=!news_lock
            GetNews();

        },5000)
  $(document).ready(function(){getUrlVars();Initialize();GetNews()})
  var firstLoad=true;
  var project;
  function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    });
    urlvals=vars;

    console.log(urlvals);
    for (var key in urlvals)
    {
        var obj=document.getElementById(key);

        if(obj)
        {
            obj.value=urlvals[key]
        }
        console.log(key);
        console.log(urlvals[key])
    }
}
function GetNews()
  {

        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                //console.log(this.responseText)
                if(this.responseText != "")
                {
                    newsList=JSON.parse(this.responseText);
                    MakeNews(newsList);

                }

            }
        };


        //console.log("mchb.php");
        xmlhttp.open("GET","./php/getNews.php",true);
        xmlhttp.send();
  }
  function MakeNews(newsList)
  {
    if(document.getElementById("newsstand").children.length==0 && newsList.length !=0 )
    {
        console.log(newsList)
        var newsanchor=document.getElementById("newsstand")
        var tickerDiv= document.createElement("DIV")
        tickerDiv.id="tickerDIV"
        tickerDiv.className="news-ticker"

        var tickerTexts= document.createElement("DIV")
        tickerTexts.id="tickerTexts"
        tickerTexts.className="ticker"

        var tickerHolder= document.createElement("SPAN")
        tickerHolder.id="tickerHolder"
        tickerHolder.className="ticker-holder"

        tickerTexts.appendChild(tickerHolder);
        tickerDiv.appendChild(tickerTexts)
        newsanchor.appendChild(tickerDiv)

        for(var i=0; i< newsList.length;i++)
        {
            var CSPAN=document.createElement("SPAN");
            CSPAN.id="newsSpan_"+toString(i);
            CSPAN.innerHTML="<strong>"+newsList[i].header+"</strong>:   "+newsList[i].text+"               </span>";
            tickerHolder.appendChild(CSPAN)

        }

        try {
        var ticker_holder = $('.ticker-holder').get(0);
        var ticker_text = $('.ticker').get(0);
        var ticker_pos = ticker_text.parentNode.offsetWidth;

        var ticker_data = $(ticker_holder).html();
        $(ticker_text).parent().html('<marquee id="marquee" scrollamount="10" scrolldelay="">' + ticker_data + '</marquee>');

        $('.news-ticker').hover(

        function() {
            $('marquee', this).get(0).stop();
        }, function() {
            $('marquee', this).get(0).start();
        });


    }
    catch (o) {}

    }
    else if( document.getElementById("newsstand").children.length!=0 && newsList.length !=0)
    {
        //UPDATE
        //delete children and repopulate
        var myNode = document.getElementById("marquee");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }

        for(var i=0; i< newsList.length;i++)
        {
            var CSPAN=document.createElement("SPAN");
            CSPAN.id="newsSpan_"+toString(i);
            CSPAN.innerHTML="<strong>"+newsList[i].header+"</strong>:   "+newsList[i].text+"               </span>";
            myNode.appendChild(CSPAN)

        }

    }
    else if( document.getElementById("newsstand").children.length!=0 && newsList.length ==0)
    {
        //DESTROY
        //console.log("EXISTS")
        var myNode = document.getElementById("newsstand");
        while (myNode.firstChild) {
            myNode.removeChild(myNode.firstChild);
        }
    }
    news_lock=!news_lock
  }
function checkInput(name)
{
    if(!document.getElementById(name))
        return

    objvalue = document.getElementById(name).value;

    console.log(objvalue)
}
function prefillForm()
{
    if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                result=JSON.parse(this.responseText)[0];
                console.log("PREFILL")
                console.log(result)
                project=result;

                if(!result.Exp)
                {
                    alert("no expirement found" )
                    return
                }

                if(result.Exp=="GlueX" || result.Exp == "gluex")
                {
                    document.getElementById("GlueX").checked=true;
                    MakeGlueXBeamTimeSelector();
                    ChangeLogo("GlueX")

                }
                else if( result.Exp=="CPP")
                {
                    document.getElementById("CPP").checked=true;
                    MakeCPPBeamTimeSelector()
                    MakeCPPForm()
                    ChangeLogo("CPP")
                }
                else if( result.Exp=="JEF")
                {
                    document.getElementById("JEF").checked=true;
                    MakeJEFBeamTimeSelector()
                    MakeJEFForm()
                    ChangeLogo("JEF")
                }
                else
                {
                    alert("Failed to find valid form")
                }

                LoopAndFill(result);


                }

            }
            query_to_do="SELECT DISTINCT"

        console.log("./php/getForm.php?id="+document.getElementById("prefill").value)
        xmlhttp.open("GET","./php/getForm.php?id="+document.getElementById("prefill").value);


        xmlhttp.send();

}
function LoopAndFill(result)
{
    if(document.getElementById('mod').value==2)
    {
        document.getElementById("uname").value=""//result.Submitter;
        document.getElementById("email").value=""//result.Email;
    }
    else
    {
        document.getElementById("uname").value=result.Submitter;
        document.getElementById("email").value=result.Email;
    }


    if(result.Exp == "CPP" || result.Exp =="GlueX" || result.Exp =="JEF")
    {
        DoReconQuery();
    }


    MakeSelectedByValue(document.getElementById("recon_stack"),result.recon_ver)
    MakeSelectedByValue(document.getElementById("sim_ver"),result.sim_ver)
    MakeSelectedByValue(document.getElementById("verSet"),result.VersionSet)
    if(result.RunNumLow == result.RunNumHigh)
    {
        document.getElementById("runnum").value=result.RunNumLow
    }
    else
    {
        MakeSelectedByValue(document.getElementById("numOrRange"),"Range")
        updateRangeoptions();
        document.getElementById("runnum").value=result.RunNumLow
        document.getElementById("maxRunNum").value=result.RunNumHigh
        document.getElementById("maxrunrange").value=result.RunNumHigh
        document.getElementById("rcdbq").value=result.RCDBQuery
    }

    document.getElementById("numevt").value=result.NumEvents
    document.getElementById("output").value=result.OutputLocation
    MakeSelectedByValue(document.getElementById("generator"),result.Generator)
    updateGenConfig();
    document.getElementById("genconfig").value=result.Generator_Config

    document.getElementById("GenMinE").value=parseFloat(result.GenMinE).toFixed(2)
    document.getElementById("GenMaxE").value=parseFloat(result.GenMaxE).toFixed(2)

    var cohpeak=document.getElementById("cohPos")


    if(cohpeak)
    {
        if(result.CoherentPeak)
        {
            cohpeak.value=result.CoherentPeak
        }
    }

    if(result.GenFlux == "ccdb")
    {
        document.getElementById("ccdb_flux").checked=true;
    }
    else if( result.GenFlux == "cobrems" )
    {
        document.getElementById("cobrems_flux").checked=true;
    }

    if(result.GenPostProcessing)
    {
        //split by colon
        var post_list=result.GenPostProcessing.split(":")
        MakeSelectedByValue(document.getElementById("GenPost"),post_list[0])
        updateGenPost();
        if(post_list[0]=="decay_evtgen")
        {
            document.getElementById("f1_input").value=post_list[1]
            document.getElementById("f2_input").value=post_list[2]
            document.getElementById("f3_input").value=post_list[3]
        }
    }

    if(result.GeantVersion == "3")
    {
        document.getElementById("Geant3").checked=true;
    }
    else if( result.GeantVersion == "4" )
    {
        document.getElementById("Geant4").checked=true;
    }

    if(result.GeantSecondaries == "1")
    {
        document.getElementById("GeantSecondaries").checked=true;
    }
    else
    {
        document.getElementById("GeantSecondaries").checked=false;
    }

    var bkgarr=result.BKG.split(/:(.+)/)

    if(bkgarr.length==1)
    {
        MakeSelectedByValue(document.getElementById("bkg"),result.BKG)
        updateBKGoptions();
    }
    else if(bkgarr[0]=="loc")
    {
        MakeSelectedByValue(document.getElementById("bkg"),"Random loc:/")
        updateBKGoptions();
        document.getElementById("randomtag").value=bkgarr[1];

    }
    else if( bkgarr[0]=="Random")
    {
        MakeSelectedByValue(document.getElementById("bkg"),bkgarr[0])
        updateBKGoptions();
        document.getElementById("randomtag").value=bkgarr[1];
        MakeSelectedByValue(document.getElementById("randomtag"),bkgarr[1])
    }
    else if( bkgarr[0]=="BeamPhotons")
    {
        MakeSelectedByValue(document.getElementById("bkg"),bkgarr[0])
        updateBKGoptions();
        document.getElementById("randomtag").value=bkgarr[1];

    }
    else if (bkgarr[0]=="TagOnly")
    {
        MakeSelectedByValue(document.getElementById("bkg"),bkgarr[0])
        updateBKGoptions();
        document.getElementById("randomtag").value=bkgarr[1];
    }

    if(result.ReactionLines.includes("file:") )
    {
    MakeSelectedByValue(document.getElementById("ANAStyle"),"JanaConfig")
    updateANA(result.ReactionLines.replace("file:",""));
    DoANASetQuery()
    if(result.ANAVersionSet != null)
    {
        MakeSelectedByValue(document.getElementById("anaverSet"),result.ANAVersionSet)
    }

    }
    else{
        MakeSelectedByValue(document.getElementById("ANAStyle"),"ReactionFilter")
        updateANA(result.ReactionLines);
        document.getElementById("ReactionLines").style.visibility="visible"
        document.getElementById("ReactionLines").class=""
        document.getElementById("ReactionLines").value=result.ReactionLines
        document.getElementById("ReactionFilter").value="Reactions Set";
    }



    if(result.RunGeneration == "1")
    {
        document.getElementById("RunGeneration").checked=true;
    }
    else
    {
        document.getElementById("RunGeneration").checked=false;
    }
    if(result.RunGeant == "1")
    {
        document.getElementById("RunGeant").checked=true;
    }
    else
    {
        document.getElementById("RunGeant").checked=false;
    }
    if(result.RunSmear == "1")
    {
        document.getElementById("RunSmear").checked=true;
    }
    else
    {
        document.getElementById("RunSmear").checked=false;
    }
    if(result.RunReconstruction == "1")
    {
        document.getElementById("RunRecon").checked=true;
    }
    else
    {
        document.getElementById("RunRecon").checked=false;
    }

    if(result.SaveGeneration == "1")
    {
        document.getElementById("SaveGeneration").checked=true;
    }
    else
    {
        document.getElementById("SaveGeneration").checked=false;
    }
    if(result.SaveGeant == "1")
    {
        document.getElementById("SaveGeant").checked=true;
    }
    else
    {
        document.getElementById("SaveGeant").checked=false;
    }
    if(result.SaveSmear == "1")
    {
        document.getElementById("SaveSmear").checked=true;
    }
    else
    {
        document.getElementById("SaveSmear").checked=false;
    }
    if(result.SaveReconstruction == "1")
    {
        document.getElementById("SaveRecon").checked=true;
    }
    else
    {
        document.getElementById("SaveRecon").checked=false;
    }

    document.getElementById("additionalreq").value=result.Comments

    if(document.getElementById("mod").value=="1")
    {
    MakeUpdateButton();
    }
    else if(document.getElementById("mod").value=="2")
    {
        console.log(document.getElementById("output").value)
        var trunkpath=document.getElementById("output").value.replace("/lustre/expphy/cache/halld/halld-scratch/REQUESTED_MC/",'')
        var oldpath=trunkpath.split("/")
        console.log("SPLIT")
        console.log(oldpath)
        if(document.getElementById("blockname").value=="")
        {
            document.getElementById("blockname").value=oldpath[0]
        }
        var oldnameparts=oldpath[0].split("_")
        if(oldpath.length==3)
        {
            oldnameparts=oldpath[1].split("_")
        }
        var oldname=""
        for(var i=0;i<oldnameparts.length-1;i++)
        {
            if(oldnameparts[i]==document.getElementById("blockname").value)
                continue;
            else
            {
                oldname+=oldnameparts[i]+"_"
            }
        }
        oldname=oldname.substring(0,oldname.length-1)
        var outname=""
        outname+=document.getElementById("blockname").value
        if(outname!="")
        {
            outname+="/"
        }
        outname+=oldname

        document.getElementById("output").value=outname
        MakeSubmitButton();
    }


}
function MakeSelectedByValue(select,val)
{
  for (var i = 0; i < select.length; i++){
    var option = select.options[i];
    // now have option.text, option.value
    if (option.value==val)
    {
        option.selected=true;
    }
    else
    {
        option.selected=false;
    }
  }
}
function Initialize()
{
    var prefill=document.getElementById("prefill").value
    if(prefill != "-1")
    {
        prefillForm()
    }
    else
    {
      MakeGlueXBeamTimeSelector();MakeCheckButton();alphabetizeslector()
    }
    getBalance();
}
function getBalance()
{
    if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                console.log(this.responseText)
                balresult=JSON.parse(this.responseText);

                document.getElementById("balance").innerHTML="Current Balance: "+"1 wc"//balresult[0].wc+" wc"
                document.getElementById("wall").value=1.0;//parseFloat(balresult[0].wc);
                document.getElementById("spend").max=0.01;//parseFloat(balresult[0].wc);

                }

            }


        xmlhttp.open("GET","./php/wcwall.php");


        xmlhttp.send();
}
  function alphabetizeslector()
    {
        var selected = $("#generator option:selected")[0].value

        $("#generator").html($("#generator option").sort(function (a, b) {
        return a.text == b.text ? 0 : a.text < b.text ? -1 : 1
        }))
        for(i=0;i<$("#generator option").length;i++)
        {
            if($("#generator option")[i].value == selected)
            {
                $("#generator option")[i].selected = true
            }
            else
            {
                $("#generator option")[i].selected = false
            }
        }

    }
function ChangeLogo(newlogo)
{
    if(newlogo=="CPP")
    {
        $("#explogo").attr("src","./imgs/cpplogo.png");
        document.getElementById("explogo").style.className="run-fadeIn";
    }
    else if(newlogo == "JEF")
    {
        $("#explogo").attr("src","./imgs/jeflogo.png");
        document.getElementById("explogo").style.className="run-fadeIn";
    }
    else
    {
        $("#explogo").attr("src","./imgs/gluexlogo.png");
        document.getElementById("explogo").style.className="run-fadeIn";
    }

}
function MakeGlueXBeamTimeSelector()
{
    
    MakeGluexForm();

    var form=document.getElementById("beamtimeSelector");
    form.innerHTML=""
    form.setAttribute("class","switch-field")

    var selLabel=document.createElement("div")
    selLabel.setAttribute("class","switch-title")
    selLabel.appendChild(document.createTextNode("Beam time"))
    form.appendChild(selLabel)

    
    var in20170103 = document.createElement("input")
    in20170103.setAttribute("type","radio")
    in20170103.setAttribute("id","in20170103")
    in20170103.setAttribute("name","btsel")
    in20170103.setAttribute("value","2017_01-ver03")
    in20170103.setAttribute("onclick","FillDefaults('2017_01-ver03');")
    form.appendChild(in20170103)
    var label20170103=document.createElement("LABEL");
    label20170103.setAttribute("for", "in20170103");
    label20170103.appendChild(document.createTextNode("2017-01 (ver03)"))
    form.appendChild(label20170103)
    var in20170104 = document.createElement("input")
    in20170104.setAttribute("type","radio")
    in20170104.setAttribute("id","in20170104")
    in20170104.setAttribute("name","btsel")
    in20170104.setAttribute("value","2017_01-ver04")
    in20170104.setAttribute("onclick","FillDefaults('2017_01-ver04');")
    form.appendChild(in20170104)
    var label20170104=document.createElement("LABEL");
    label20170104.setAttribute("for", "in20170104");
    label20170104.appendChild(document.createTextNode("2017-01 (ver04)"))
    form.appendChild(label20170104)
    var in201801 = document.createElement("input")
    in201801.setAttribute("type","radio")
    in201801.setAttribute("id","in201801")
    in201801.setAttribute("name","btsel")
    in201801.setAttribute("value","2018_01")
    in201801.setAttribute("onclick","FillDefaults('2018_01-ver02');")
    form.appendChild(in201801)
    var label201801=document.createElement("LABEL");
    label201801.setAttribute("for", "in201801");
    label201801.appendChild(document.createTextNode("2018-01"))
    form.appendChild(label201801)
    var in201808 = document.createElement("input")
    in201808.setAttribute("type","radio")
    in201808.setAttribute("id","in201808")
    in201808.setAttribute("name","btsel")
    in201808.setAttribute("value","2018_08")
    in201808.setAttribute("onclick","FillDefaults('2018_08-ver02');")
    form.appendChild(in201808)
    var label201808=document.createElement("LABEL");
    label201808.setAttribute("for", "in201808");
    label201808.appendChild(document.createTextNode("2018-08"))
    form.appendChild(label201808)
    var in201808lowE = document.createElement("input")
    in201808lowE.setAttribute("type","radio")
    in201808lowE.setAttribute("id","in201808lowE")
    in201808lowE.setAttribute("name","btsel")
    in201808lowE.setAttribute("value","2018_08")
    in201808lowE.setAttribute("onclick","FillDefaults('lowE');")
    form.appendChild(in201808lowE)
    var label201808lowE=document.createElement("LABEL");
    label201808lowE.setAttribute("for", "in201808lowE");
    label201808lowE.appendChild(document.createTextNode("2018-08 lowE"))
    form.appendChild(label201808lowE)
    var in201911 = document.createElement("input")
    in201911.setAttribute("type","radio")
    in201911.setAttribute("id","in201911")
    in201911.setAttribute("name","btsel")
    in201911.setAttribute("value","2019_11")
    in201911.setAttribute("onclick","FillDefaults('2019_11-ver01');")
    form.appendChild(in201911)
    var label201911=document.createElement("LABEL");
    label201911.setAttribute("for", "in201911");
    label201911.appendChild(document.createTextNode("2019-11"))
    form.appendChild(label201911)
    var inCustom = document.createElement("input")
    inCustom.setAttribute("type","radio")
    inCustom.setAttribute("id","inCustom")
    inCustom.setAttribute("name","btsel")
    inCustom.setAttribute("value","custom")
    inCustom.setAttribute("checked",true)
    inCustom.setAttribute("onclick","FillDefaults('custom');")
    form.appendChild(inCustom)
    var labelCustom=document.createElement("LABEL");
    labelCustom.setAttribute("for", "inCustom");
    labelCustom.appendChild(document.createTextNode("custom"))
    form.appendChild(labelCustom)
    
}
function FillDefaults(beamtime){
    
    //VERSION SETS (Pick the first that fits the beam time. It will be the most recent.)
    var reconver = document.getElementById("recon_stack")
    for(var i = 0; i < reconver.length; i++){
        if(reconver[i].value.startsWith("recon-"+beamtime)){
            MakeSelectedByValue(reconver,reconver[i].value)
            break
        }
        else if(beamtime=="2017_01-ver04" && reconver[i].value.startsWith("recon-2019_11-ver01")){ //special case since 2017_01-ver04 is same reco as 2019_11-ver01
            MakeSelectedByValue(reconver,reconver[i].value)
            break
        }
        else if (beamtime=="lowE" && reconver[i].value.startsWith("recon-2018_08")){
            MakeSelectedByValue(reconver,reconver[i].value)
            break
        }
        else if (beamtime=="custom"){
            MakeSelectedByValue(reconver,reconver[0].value)
            break
        }
    }

    //DoSimQuery()
    // need to do it here since we need to wait for XMLHttpRequest to respond
    // before we can set the version set "by hand", couldn't do it with a function call
    var selRecon = reconver.options[reconver.selectedIndex].value;
    if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    } else {
        // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            result=JSON.parse(this.responseText);
            console.log(result)
            PopulateVer("sim_ver",result)
            if(document.getElementById("prefill").value != "-1" )
            {
            MakeSelectedByValue(document.getElementById("sim_ver"),project.sim_ver)
            }

            // DoSetQuery()
            var sims = document.getElementById("sim_ver");
            var selSim = sims.options[sims.selectedIndex].value;
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp2 = new XMLHttpRequest();
            } else {
                // code for IE6, IE5
                xmlhttp2 = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp2.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {

                    result2=JSON.parse(this.responseText);

                    console.log(result2)
                    PopulateVer("verSet",result2)
                    if(document.getElementById("prefill").value != "-1" )
                    {

                    MakeSelectedByValue(document.getElementById("verSet"),project.VersionSet)
                    }
                    //special case since 2017_01-ver04 is same reco as 2019_11-ver01 but has different version set
                    //can easily be generalised if more such cases arise
                    if(beamtime=="2017_01-ver04"){
                        var verset = document.getElementById("verSet")
                        for(var i = 0; i < verset.length; i++){
                            if(verset[i].value.startsWith("recon-2017_01-ver04")){
                                MakeSelectedByValue(verset,verset[i].value)
                                break
                            }
                        }
                    }
                    updatePreview();
                    if(document.getElementById("ReactionLines").value != "" && document.getElementById("prefill").value != "-1" && !document.getElementById("anaverSet"))
                    {
                    addANAselector()
                    }
                    else if(document.getElementById("anaverSet"))
                    {
                        DoANASetQuery();
                    }
                }

            }
            query_to_do="SELECT DISTINCT"
            console.log("./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver="+selSim)
            xmlhttp2.open("GET","./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver="+selSim);
            xmlhttp2.send();
            }

        }
    query_to_do="SELECT DISTINCT"
    console.log("./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver=unknown")
    xmlhttp.open("GET","./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver=unknown");
    xmlhttp.send();


    //RUNRANGES
    var range = document.getElementById("numOrRange")
    if(beamtime=="custom")
    {
        if(range.value=="Range"){
            MakeSelectedByValue(range,"Number")
            updateRangeoptions()
        }
        var runmin = document.getElementById("runnum")
        runmin.value=""
        document.getElementById("maxrunrange").value=""
        document.getElementById("savedrcdbquery").value=""
        document.getElementById("savedrcdbquery").removeAttribute("readonly")
    }
    else {
        if(range.value=="Number"){
            MakeSelectedByValue(range,"Range")
            updateRangeoptions()
        }
        var runmin = document.getElementById("runnum")
        var runmax = document.getElementById("maxRunNum")
        beamtime == "2017_01-ver03" ? runmin.value=30274
        : beamtime == "2017_01-ver04" ? runmin.value=30274
        : beamtime == "2018_01-ver02" ? runmin.value=40856
        : beamtime == "2018_08-ver02" ? runmin.value=50677
        : beamtime == "lowE" ? runmin.value=51384
        : beamtime == "2019_11-ver01" ? runmin.value=71350
        : runmin.value=""
        beamtime == "2017_01-ver03" ? runmax.value=31057
        : beamtime == "2017_01-ver04" ? runmax.value=31057
        : beamtime == "2018_01-ver02" ? runmax.value=42577
        : beamtime == "2018_08-ver02" ? runmax.value=51768
        : beamtime == "lowE" ? runmax.value=51457
        : beamtime == "2019_11-ver01" ? runmax.value=73266
        : runmax.value=""
        document.getElementById("maxrunrange").value=runmax.value

        // RCDB CALL
        if(document.getElementById("rcdbq")){
            var rcdbquery = document.getElementById("rcdbq")
            beamtime == "2017_01-ver03" ?  rcdbquery.value="@is_production and @status_approved"
            : beamtime == "2017_01-ver04" ?  rcdbquery.value="@is_production and @status_approved"
            : beamtime == "2018_01-ver02" ?  rcdbquery.value="@is_2018production and @status_approved"
            : beamtime == "2018_08-ver02" ?  rcdbquery.value="@is_2018production and @status_approved and beam_on_current>49"
            : beamtime == "lowE" ?  rcdbquery.value="@is_2018production and @status_approved and beam_on_current<49"
            : beamtime == "2019_11-ver01" ?  rcdbquery.value="@is_dirc_production and @status_approved"
            : rcdbquery.value=""
            rcdbquery.setAttribute("readonly","")
            document.getElementById("savedrcdbquery").value=rcdbquery.value
            document.getElementById("savedrcdbquery").setAttribute("readonly","")
        }
    }

    // FLUX
    if(beamtime=="custom")
    {
        document.getElementById("ccdb_flux").checked=true
        document.getElementById("ccdb_flux").style.visibility="initial"
        document.getElementById("cobrems_flux").checked=false
        document.getElementById("cobrems_flux").style.visibility="initial"
        document.getElementById("cobremsText").style.visibility="initial"
    }
    else {
        document.getElementById("ccdb_flux").checked=true
        document.getElementById("ccdb_flux").style.visibility="hidden"
        document.getElementById("cobrems_flux").checked=false
        document.getElementById("cobrems_flux").style.visibility="hidden"
        document.getElementById("cobremsText").style.visibility="hidden"
        
    }

    // GEANT
    if(beamtime=="custom")
    {
        document.getElementById("Geant3").style.visibility="initial"
        document.getElementById("Geant3text").style.visibility="initial"
        document.getElementById("Geant4").style.visibility="initial"
        document.getElementById("GeantSecondaries").style.visibility="initial"
        document.getElementById("GeantSecYes").style.visibility="hidden"
    }
    else {
        document.getElementById("Geant3").checked=false
        document.getElementById("Geant3").style.visibility="hidden"
        document.getElementById("Geant3text").style.visibility="hidden"
        document.getElementById("Geant4").checked=true
        document.getElementById("Geant4").style.visibility="hidden"
        document.getElementById("GeantSecondaries").style.visibility="hidden"
        document.getElementById("GeantSecondaries").checked=true
        document.getElementById("GeantSecYes").style.visibility="visible"
    }

    //BACKGROUNDS
    var bkgselect = document.getElementById("bkg")
    if(beamtime=="custom")
    {
        MakeSelectedByValue(bkgselect,"None")
        updateBKGoptions();
        
    }
    else {
        MakeSelectedByValue(bkgselect,"Random")
        updateBKGoptions();
        
        var rndtag = document.getElementById("randomtag")
        beamtime == "2017_01-ver03" ? MakeSelectedByValue(rndtag,"recon-2017_01-ver03.2")
        : beamtime == "2017_01-ver04" ? MakeSelectedByValue(rndtag,"recon-2017_01-ver03.2")
        : beamtime == "2018_01-ver02" ? MakeSelectedByValue(rndtag,"recon-2018_01-ver02.2")
        : beamtime == "2018_08-ver02" ? MakeSelectedByValue(rndtag,"recon-2018_08-ver02.2")
        : beamtime == "lowE" ? MakeSelectedByValue(rndtag,"recon-2018_08-ver02.2")
        : beamtime == "2019_11-ver01" ? MakeSelectedByValue(rndtag,"recon-2019_11-ver01")
        : MakeSelectedByValue(rndtag,"recon-2017_01-ver03.2")
    }

    MakeCheckButton()

}

function MakeCPPBeamTimeSelector()
{
    var form=document.getElementById("beamtimeSelector");
    form.innerHTML=""
}
function MakeJEFBeamTimeSelector()
{
    var form=document.getElementById("beamtimeSelector");
    form.innerHTML=""
}
function MakeGluexForm()
{
    var form=document.getElementById("expform");
    form.innerHTML=""

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var reclabel=document.createElement("LABEL");
    reclabel.setAttribute("for", "recon_stack");
    reclabel.appendChild(document.createTextNode("halld_recon version:"))
    form.appendChild(reclabel)

    var verFAQ=document.createElement("IMG");
    verFAQ.src="./imgs/q_mark.png"
    verFAQ.style.height='20px'
    verFAQ.style.width='20px'
    verFAQ.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };


    var recselect=document.createElement("SELECT")
    recselect.id="recon_stack"
    recselect.name="halld_recon_ver"
    recselect.setAttribute("onchange","DoSimQuery();MakeCheckButton();");
    form.appendChild(recselect)
    verFAQ2=verFAQ.cloneNode()
    verFAQ2.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };
    form.appendChild(verFAQ2)
    form.appendChild(document.createElement("BR"))

    var simlabel=document.createElement("LABEL");
    simlabel.setAttribute("for", "sim_ver");
    simlabel.appendChild(document.createTextNode("halld_sim version:"))
    form.appendChild(simlabel)
    var simselect=document.createElement("SELECT")
    simselect.id="sim_ver"
    simselect.name="halld_sim_ver"
    simselect.setAttribute("onchange","DoSetQuery();MakeCheckButton();");
    form.appendChild(simselect)
    verFAQ3=verFAQ.cloneNode()
    verFAQ3.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };
    form.appendChild(verFAQ3)
    form.appendChild(document.createElement("BR"))

    var verlabel=document.createElement("LABEL");
    verlabel.setAttribute("for", "verSet");
    verlabel.appendChild(document.createTextNode("version Set:"))
    form.appendChild(verlabel)
    var verselect=document.createElement("SELECT")
    verselect.id="verSet"
    verselect.name="versionSet"
    verselect.setAttribute("onchange","updatePreview();DoANASetQuery();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(verselect)
    form.appendChild(verFAQ)
    form.appendChild(document.createElement("BR"))


    DoReconQuery();

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

//RUN NUMBER/RANGE AND EVENTS
    var Runlabel=document.createElement("LABEL");
    Runlabel.setAttribute("for", "verSet");
    Runlabel.appendChild(document.createTextNode("Run"))

    form.appendChild(Runlabel)
    var runselect=document.createElement("SELECT")
    runselect.id="numOrRange"
    runselect.setAttribute("onchange","updateRangeoptions();MakeCheckButton();");

    var runnum=document.createElement("OPTION");
    runnum.value="Number";
    runnum.text="Number";
    //runnum.data-tip="The run number you wish to simulate"
    runnum.selected=true;
    runselect.appendChild(runnum)
    var runrange=document.createElement("OPTION");
    runrange.value="Range";
    runrange.text="Range";
    runselect.appendChild(runrange)

    form.appendChild(runselect)

    var runnumlow=document.createElement("INPUT")
    runnumlow.type="number"
    runnumlow.id="runnum"
    runnumlow.name="runnumber"
    runnumlow.placeholder="11366"
    runnumlow.title="Place the desired run number to simulate here"
    runnum.required=true;
    form.appendChild(runnumlow);

    var evtslabel=document.createElement("LABEL");
    evtslabel.setAttribute("for", "numevt");
    evtslabel.id="evtslabel"
    evtslabel.appendChild(document.createTextNode("      Number of Events"))
    form.appendChild(evtslabel)
    var numevts=document.createElement("INPUT")
    numevts.type="number"
    numevts.min=1
    numevts.max=500000000
    numevts.id="numevt"
    numevts.name="numevents"
    numevts.placeholder="1000000"
    numevts.required=true;
    numevts.title="Integer number representing the total desired events to produce. Must be between 1 and 250 million"
    numevts.style.width="20%";
    form.appendChild(numevts);

    //OUTPUT
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var outputlabel=document.createElement("LABEL");
    outputlabel.setAttribute("for", "output");
    outputlabel.appendChild(document.createTextNode("Output Directory Name"))
    form.appendChild(outputlabel)
    var outputloc=document.createElement("INPUT")
    outputloc.type="text"
    outputloc.id="output"
    outputloc.name="outputloc"
    outputloc.placeholder="My_MC"
    outputloc.required=true;
    outputloc.title="The root title of the output directory. NOT the full path. \nNo more than 1 / allowed)"
    outputloc.pattern="[^()\/{,2}><\][\\\x22,;|]+"
    outputloc.style.width="60%";
    form.appendChild(outputloc);

    //GENERATOR
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var genlabel=document.createElement("LABEL");
    genlabel.setAttribute("for", "Generator");
    genlabel.appendChild(document.createTextNode("Generator"))
    form.appendChild(genlabel)
    var genselect=document.createElement("SELECT")
    genselect.id="generator"
    genselect.name="generator"
    genselect.setAttribute("onchange","updateGenConfig();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(genselect)
    var gen_q=document.createElement("IMG");
    gen_q.src="./imgs/q_mark.png"
    gen_q.style.height='20px'
    gen_q.style.width='20px'
    gen_q.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/Event_generators',"_blank")
    };
    form.appendChild(gen_q)

    populateGenerators("GlueX");

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var genconflabel=document.createElement("LABEL");
    genconflabel.setAttribute("for", "genconfig");
    genconflabel.appendChild(document.createTextNode("Full Path to Generator Config"))
    form.appendChild(genconflabel)
    var genconfloc=document.createElement("INPUT")
    genconfloc.type="text"
    genconfloc.id="genconfig"
    genconfloc.name="generator_config"
    genconfloc.placeholder="full path must be reachable by tbritton from an ifarm machine"
    genconfloc.required=true;
    genconfloc.title="The full path for the file that configures the above generator. It and the containing directories must be readable and reachable from the interactive farm."
    genconfloc.style.width="60%";
    form.appendChild(genconfloc);
    var genconf_q=document.createElement("IMG");
    genconf_q.src="./imgs/q_mark.png"
    genconf_q.style.height='20px'
    genconf_q.style.width='20px'
    genconf_q.onclick = function() {
        window.open('https://github.com/JeffersonLab/gluex_MCwrapper/tree/master/Generators',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };
    form.appendChild(genconf_q)
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))


    var fluxgenlabel=document.createElement("LABEL");
    fluxgenlabel.setAttribute("for", "GenFlux");
    fluxgenlabel.appendChild(document.createTextNode("Flux to Generate:"))
    form.appendChild(fluxgenlabel)
    var ccdbin=document.createElement("INPUT");
    ccdbin.type="radio"
    ccdbin.id="ccdb_flux"
    ccdbin.name="Genflux"
    ccdbin.value="ccdb"
    ccdbin.checked=true;
    ccdbin.setAttribute("onclick","updateGenFluxOptions();MakeCheckButton();");

    form.appendChild(ccdbin);
    var ccdbText=document.createElement("span")
    ccdbText.setAttribute("id","ccdbText")
    ccdbText.appendChild(document.createTextNode("ccdb"))
    form.appendChild(ccdbText)

    var cobremsin=document.createElement("INPUT");
    cobremsin.type="radio"
    cobremsin.id="cobrems_flux"
    cobremsin.value="cobrems"
    cobremsin.checked=false;
    cobremsin.name="Genflux"
    cobremsin.setAttribute("onclick","updateGenFluxOptions();MakeCheckButton();");


    form.appendChild(cobremsin);
    var cobremsText=document.createElement("span")
    cobremsText.setAttribute("id","cobremsText")
    cobremsText.appendChild(document.createTextNode("cobrems"))
    form.appendChild(cobremsText)

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //PHOTON ENERGIES
    var minElabel=document.createElement("LABEL");
    minElabel.setAttribute("for", "GenMinE");
    minElabel.appendChild(document.createTextNode("Min Photon E:"))
    form.appendChild(minElabel)
    var minEin=document.createElement("INPUT")
    minEin.type="number"
    minEin.step="0.01"
    minEin.id="GenMinE"
    minEin.name="GenMinE"
    minEin.placeholder="3.0 [GeV]"
    minEin.required=true;
    minEin.title="Minimum beam photon energy to simulate rounded to the nearest 10 MeV"
    minEin.style.width="14%";
    form.appendChild(minEin);

    var maxElabel=document.createElement("LABEL");
    maxElabel.setAttribute("for", "GenMaxE");
    maxElabel.appendChild(document.createTextNode("Max Photon E:"))
    form.appendChild(maxElabel)
    var maxEin=document.createElement("INPUT")
    maxEin.type="number"
    maxEin.step="0.01"
    maxEin.id="GenMaxE"
    maxEin.name="GenMaxE"
    maxEin.placeholder="11.6 [GeV]"
    maxEin.required=true;
    maxEin.title="Maximum beam photon energy to simulate rounded to the nearest 10 MeV"
    maxEin.style.width="14%";
    form.appendChild(maxEin);

    form.appendChild(document.createElement("BR"))
    //form.appendChild(document.createElement("BR"))

    //GENERATOR POST-PROCESSING
    var genpostlabel=document.createElement("LABEL");
    genpostlabel.setAttribute("for", "GenPost");
    genpostlabel.appendChild(document.createTextNode("Post-Processing:"))
    form.appendChild(genpostlabel)
    var genpostselect=document.createElement("SELECT")
    genpostselect.id="GenPost"
    genpostselect.name="GenPost"
    genpostselect.setAttribute("onchange","updateGenPost();MakeCheckButton();");
    form.appendChild(genpostselect)

    populateGenPost("GlueX");
    var geant_br_anchor=document.createElement("BR")
    geant_br_anchor.id="geant_br_anchor"
    form.appendChild(geant_br_anchor)
    form.appendChild(document.createElement("BR"))

    //GEANT VER
    var geantlabel=document.createElement("LABEL");
    geantlabel.setAttribute("for", "Geantver");
    geantlabel.setAttribute("id","Geant3Label")
    geantlabel.appendChild(document.createTextNode("Geant Version:"))
    form.appendChild(geantlabel)
    var g3in=document.createElement("INPUT");
    g3in.type="radio"
    g3in.id="Geant3"
    g3in.name="Geantver"
    g3in.value="3"
    g3in.checked=false;
    g3in.setAttribute("onclick","MakeCheckButton();");

    form.appendChild(g3in);
    var Geant3text = document.createElement("span")
    Geant3text.setAttribute("id","Geant3text")
    Geant3text.appendChild(document.createTextNode("Geant3"))
    form.appendChild(Geant3text)

    var g4in=document.createElement("INPUT");
    g4in.type="radio"
    g4in.id="Geant4"
    g4in.value="4"
    g4in.checked=true;
    g4in.name="Geantver"
    g4in.setAttribute("onclick","MakeCheckButton();");


    form.appendChild(g4in);
    var Geant4text = document.createElement("span")
    Geant4text.setAttribute("id","Geant4text")
    Geant4text.appendChild(document.createTextNode("Geant4"))
    form.appendChild(Geant4text)

    form.appendChild(document.createElement("BR"))

    //GEANT SECONDARIES
    var geantseclabel=document.createElement("LABEL");
    geantseclabel.setAttribute("id","GeantSecondariesLabel")
    geantseclabel.setAttribute("for", "Geantver");
    geantseclabel.appendChild(document.createTextNode("Geant Secondaries?"))
    form.appendChild(geantseclabel)
    var gsecin=document.createElement("INPUT");
    gsecin.type="checkbox"
    gsecin.id="GeantSecondaries"
    gsecin.name="GeantSecondaries"
    gsecin.value="GeantSecondaries"
    gsecin.checked=true;

    form.appendChild(gsecin);
    var GeantSecYes = document.createElement("span")
    GeantSecYes.setAttribute("id","GeantSecYes")
    GeantSecYes.setAttribute("style","visibility:hidden")
    GeantSecYes.appendChild(document.createTextNode("yes"))
    form.appendChild(GeantSecYes);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))


    //BACKGROUNDS
    var bkglabel=document.createElement("LABEL");
    bkglabel.setAttribute("for", "bkgconf");
    bkglabel.appendChild(document.createTextNode("Background:"))
    form.appendChild(bkglabel)
    var bkgselect=document.createElement("SELECT")
    bkgselect.id="bkg"
    bkgselect.name="bkg"
    bkgselect.setAttribute("onchange","updateBKGoptions();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(bkgselect)

    populateBackgrounds("GlueX");

    form.appendChild(document.createElement("BR"))
    var notaglabel=document.createElement("LABEL");
    notaglabel.setAttribute("for", "NoTag");
    notaglabel.appendChild(document.createTextNode("No tagger accidentals:"))
    form.appendChild(notaglabel)
    var rnotag=document.createElement("INPUT");
    rnotag.type="checkbox"
    rnotag.id="NoTag"
    rnotag.name="NoTag"
    rnotag.value="NoTag"
    rnotag.checked=false;
    form.appendChild(rnotag);


    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    ana_br_anchor=document.createElement("BR")
    ana_br_anchor.id="Ana_Anchor"
    form.appendChild(ana_br_anchor)
    //REACTION FILTER

    AnalysisFormModule(form)

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //Runnings boxes

    var rgen=document.createElement("INPUT");
    rgen.type="checkbox"
    rgen.id="RunGeneration"
    rgen.name="RunGeneration"
    rgen.value="RunGen"
    rgen.checked=true;
    form.appendChild(rgen);
    form.appendChild(document.createTextNode("Run Generation"))

    var rgeant=document.createElement("INPUT");
    rgeant.type="checkbox"
    rgeant.id="RunGeant"
    rgeant.name="RunGeant"
    rgeant.value="RunGeant"
    rgeant.checked=true;
    form.appendChild(rgeant);
    form.appendChild(document.createTextNode("Run Geant"))

    var rsmear=document.createElement("INPUT");
    rsmear.type="checkbox"
    rsmear.id="RunSmear"
    rsmear.name="RunSmear"
    rsmear.value="RunSmear"
    rsmear.checked=true;
    form.appendChild(rsmear);
    form.appendChild(document.createTextNode("Run Smearing"))

    var rrecon=document.createElement("INPUT");
    rrecon.type="checkbox"
    rrecon.id="RunRecon"
    rrecon.name="RunRecon"
    rrecon.value="RunRecon"
    rrecon.checked=true;
    form.appendChild(rrecon);
    form.appendChild(document.createTextNode("Run Reconstruction"))

    form.appendChild(document.createElement("BR"))

    var sgen=document.createElement("INPUT");
    sgen.type="checkbox"
    sgen.id="SaveGeneration"
    sgen.name="SaveGeneration"
    sgen.value="SaveGen"
    form.appendChild(sgen);
    form.appendChild(document.createTextNode("Save Generation"))

    var sgeant=document.createElement("INPUT");
    sgeant.type="checkbox"
    sgeant.id="SaveGeant"
    sgeant.name="SaveGeant"
    sgeant.value="SaveGeant"
    form.appendChild(sgeant);
    form.appendChild(document.createTextNode("Save Geant"))

    var ssmear=document.createElement("INPUT");
    ssmear.type="checkbox"
    ssmear.id="SaveSmear"
    ssmear.name="SaveSmear"
    ssmear.value="SaveSmear"
    form.appendChild(ssmear);
    form.appendChild(document.createTextNode("Save Smearing"))

    var srecon=document.createElement("INPUT");
    srecon.type="checkbox"
    srecon.id="SaveRecon"
    srecon.name="SaveRecon"
    srecon.value="SaveRecon"
    srecon.checked=true;
    form.appendChild(srecon);
    form.appendChild(document.createTextNode("Save Reconstruction"))

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    //ADDITIONAL COMMENTS
    var comlabel=document.createElement("LABEL");
    comlabel.setAttribute("for", "additionalreq");
    comlabel.appendChild(document.createTextNode("Additional Comments:"))
    form.appendChild(comlabel)
    form.appendChild(document.createElement("BR"))
    var addcom=document.createElement("textarea")
    addcom.rows=10;
    addcom.cols=50
    addcom.wrap="soft"
    addcom.id="additionalreq"
    addcom.name="addreq"

    form.appendChild(addcom)
}
function MakeJEFForm()
{
    var form=document.getElementById("expform");
    form.innerHTML=""

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var reclabel=document.createElement("LABEL");
    reclabel.setAttribute("for", "recon_stack");
    reclabel.appendChild(document.createTextNode("halld_recon version:"))
    form.appendChild(reclabel)

    var verFAQ=document.createElement("IMG");
    verFAQ.src="./imgs/q_mark.png"
    verFAQ.style.height='20px'
    verFAQ.style.width='20px'
    verFAQ.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };


    var recselect=document.createElement("SELECT")
    recselect.id="recon_stack"
    recselect.name="halld_recon_ver"
    recselect.setAttribute("onchange","DoSimQuery();MakeCheckButton();");
    form.appendChild(recselect)
    verFAQ2=verFAQ.cloneNode()
    verFAQ2.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };
    form.appendChild(verFAQ2)
    form.appendChild(document.createElement("BR"))

    var simlabel=document.createElement("LABEL");
    simlabel.setAttribute("for", "sim_ver");
    simlabel.appendChild(document.createTextNode("halld_sim version:"))
    form.appendChild(simlabel)
    var simselect=document.createElement("SELECT")
    simselect.id="sim_ver"
    simselect.name="halld_sim_ver"
    simselect.setAttribute("onchange","DoSetQuery();MakeCheckButton();");
    form.appendChild(simselect)
    verFAQ3=verFAQ.cloneNode()
    verFAQ3.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };
    form.appendChild(verFAQ3)
    form.appendChild(document.createElement("BR"))

    var verlabel=document.createElement("LABEL");
    verlabel.setAttribute("for", "verSet");
    verlabel.appendChild(document.createTextNode("version Set:"))
    form.appendChild(verlabel)
    var verselect=document.createElement("SELECT")
    verselect.id="verSet"
    verselect.name="versionSet"
    verselect.setAttribute("onchange","updatePreview();DoANASetQuery();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(verselect)
    form.appendChild(verFAQ)
    form.appendChild(document.createElement("BR"))


    DoReconQuery();

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

//RUN NUMBER/RANGE AND EVENTS
    var Runlabel=document.createElement("LABEL");
    Runlabel.setAttribute("for", "verSet");
    Runlabel.appendChild(document.createTextNode("Run"))

    form.appendChild(Runlabel)
    var runselect=document.createElement("SELECT")
    runselect.id="numOrRange"
    runselect.setAttribute("onchange","updateRangeoptions();MakeCheckButton();");

    var runnum=document.createElement("OPTION");
    runnum.value="Number";
    runnum.text="Number";
    //runnum.data-tip="The run number you wish to simulate"
    runnum.selected=true;
    runselect.appendChild(runnum)
    var runrange=document.createElement("OPTION");
    runrange.value="Range";
    runrange.text="Range";
    runselect.appendChild(runrange)

    form.appendChild(runselect)

    var runnumlow=document.createElement("INPUT")
    runnumlow.type="number"
    runnumlow.id="runnum"
    runnumlow.name="runnumber"
    runnumlow.placeholder="11366"
    runnumlow.title="Place the desired run number to simulate here"
    runnum.required=true;
    form.appendChild(runnumlow);

    var evtslabel=document.createElement("LABEL");
    evtslabel.setAttribute("for", "numevt");
    evtslabel.id="evtslabel"
    evtslabel.appendChild(document.createTextNode("      Number of Events"))
    form.appendChild(evtslabel)
    var numevts=document.createElement("INPUT")
    numevts.type="number"
    numevts.id="numevt"
    numevts.name="numevents"
    numevts.placeholder="1000000"
    numevts.required=true;
    numevts.title="Integer number representing the total desired events to produce"
    numevts.style.width="20%";
    form.appendChild(numevts);

    //OUTPUT
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var outputlabel=document.createElement("LABEL");
    outputlabel.setAttribute("for", "output");
    outputlabel.appendChild(document.createTextNode("Output Directory Name"))
    form.appendChild(outputlabel)
    var outputloc=document.createElement("INPUT")
    outputloc.type="text"
    outputloc.id="output"
    outputloc.name="outputloc"
    outputloc.placeholder="My_MC"
    outputloc.required=true;
    outputloc.title="The root title of the output directory. NOT the full path. \nNo more than 1 / allowed)"
    //outputloc.pattern="[^()/><\][\\\x22,;|]+"
    outputloc.style.width="60%";
    form.appendChild(outputloc);

    //GENERATOR
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var genlabel=document.createElement("LABEL");
    genlabel.setAttribute("for", "Generator");
    genlabel.appendChild(document.createTextNode("Generator"))
    form.appendChild(genlabel)
    var genselect=document.createElement("SELECT")
    genselect.id="generator"
    genselect.name="generator"
    genselect.setAttribute("onchange","updateGenConfig();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(genselect)

    populateGenerators("GlueX");

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var genconflabel=document.createElement("LABEL");
    genconflabel.setAttribute("for", "genconfig");
    genconflabel.appendChild(document.createTextNode("Full Path to Generator Config"))
    form.appendChild(genconflabel)
    var genconfloc=document.createElement("INPUT")
    genconfloc.type="text"
    genconfloc.id="genconfig"
    genconfloc.name="generator_config"
    genconfloc.placeholder="/.../Generators/bggen/examples/bggen_config.template"
    genconfloc.required=true;
    genconfloc.title="The full path for the file that configures the above generator. It and the containing directories must be readable and reachable from the interactive farm."
    genconfloc.style.width="60%";
    form.appendChild(genconfloc);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))


    var fluxgenlabel=document.createElement("LABEL");
    fluxgenlabel.setAttribute("for", "GenFlux");
    fluxgenlabel.appendChild(document.createTextNode("Flux to Generate:"))
    form.appendChild(fluxgenlabel)
    var ccdbin=document.createElement("INPUT");
    ccdbin.type="radio"
    ccdbin.id="ccdb_flux"
    ccdbin.name="Genflux"
    ccdbin.value="ccdb"
    ccdbin.checked=true;
    ccdbin.setAttribute("onclick","updateGenFluxOptions();MakeCheckButton();");

    form.appendChild(ccdbin);
    form.appendChild(document.createTextNode("ccdb"))

    var cobremsin=document.createElement("INPUT");
    cobremsin.type="radio"
    cobremsin.id="cobrems_flux"
    cobremsin.value="cobrems"
    cobremsin.checked=false;
    cobremsin.name="Genflux"
    cobremsin.setAttribute("onclick","updateGenFluxOptions();MakeCheckButton();");


    form.appendChild(cobremsin);
    form.appendChild(document.createTextNode("cobrems"))

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //PHOTON ENERGIES
    var minElabel=document.createElement("LABEL");
    minElabel.setAttribute("for", "GenMinE");
    minElabel.appendChild(document.createTextNode("Min Photon E:"))
    form.appendChild(minElabel)
    var minEin=document.createElement("INPUT")
    minEin.type="number"
    minEin.step="0.01"
    minEin.id="GenMinE"
    minEin.name="GenMinE"
    minEin.placeholder="3.0 [GeV]"
    minEin.required=true;
    minEin.title="Minimum beam photon energy to simulate rounded to the nearest 10 MeV"
    minEin.style.width="14%";
    form.appendChild(minEin);

    var maxElabel=document.createElement("LABEL");
    maxElabel.setAttribute("for", "GenMaxE");
    maxElabel.appendChild(document.createTextNode("Max Photon E:"))
    form.appendChild(maxElabel)
    var maxEin=document.createElement("INPUT")
    maxEin.type="number"
    maxEin.step="0.01"
    maxEin.id="GenMaxE"
    maxEin.name="GenMaxE"
    maxEin.placeholder="11.6 [GeV]"
    maxEin.required=true;
    maxEin.title="Maximum beam photon energy to simulate rounded to the nearest 10 MeV"
    maxEin.style.width="14%";
    form.appendChild(maxEin);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    //GEANT VER
    var geantlabel=document.createElement("LABEL");
    geantlabel.setAttribute("for", "Geantver");
    geantlabel.appendChild(document.createTextNode("Geant Version:"))
    form.appendChild(geantlabel)
    var g3in=document.createElement("INPUT");
    g3in.type="radio"
    g3in.id="Geant3"
    g3in.name="Geantver"
    g3in.value="3"
    g3in.checked=false;
    g3in.setAttribute("onclick","MakeCheckButton();");

    //form.appendChild(g3in);
    //form.appendChild(document.createTextNode("Geant3"))

    var g4in=document.createElement("INPUT");
    g4in.type="radio"
    g4in.id="Geant4"
    g4in.value="4"
    g4in.checked=true;
    g4in.name="Geantver"
    g4in.setAttribute("onclick","MakeCheckButton();");


    form.appendChild(g4in);
    form.appendChild(document.createTextNode("Geant4"))

    form.appendChild(document.createElement("BR"))

    //GEANT SECONDARIES
    var geantseclabel=document.createElement("LABEL");
    geantseclabel.setAttribute("for", "Geantver");
    geantseclabel.appendChild(document.createTextNode("Geant Secondaries?"))
    form.appendChild(geantseclabel)
    var gsecin=document.createElement("INPUT");
    gsecin.type="checkbox"
    gsecin.id="GeantSecondaries"
    gsecin.name="GeantSecondaries"
    gsecin.value="GeantSecondaries"
    gsecin.checked=true;

    form.appendChild(gsecin);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //BACKGROUNDS
    var bkglabel=document.createElement("LABEL");
    bkglabel.setAttribute("for", "bkgconf");
    bkglabel.appendChild(document.createTextNode("Background:"))
    form.appendChild(bkglabel)
    var bkgselect=document.createElement("SELECT")
    bkgselect.id="bkg"
    bkgselect.name="bkg"
    bkgselect.setAttribute("onchange","updateBKGoptions();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(bkgselect)

    populateBackgrounds("JEF");

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    ana_br_anchor=document.createElement("BR")
    ana_br_anchor.id="Ana_Anchor"
    form.appendChild(ana_br_anchor)
    //REACTION FILTER
    AnalysisFormModule(form)

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //Runnings boxes

    var rgen=document.createElement("INPUT");
    rgen.type="checkbox"
    rgen.id="RunGeneration"
    rgen.name="RunGeneration"
    rgen.value="RunGen"
    rgen.checked=true;
    form.appendChild(rgen);
    form.appendChild(document.createTextNode("Run Generation"))

    var rgeant=document.createElement("INPUT");
    rgeant.type="checkbox"
    rgeant.id="RunGeant"
    rgeant.name="RunGeant"
    rgeant.value="RunGeant"
    rgeant.checked=true;
    form.appendChild(rgeant);
    form.appendChild(document.createTextNode("Run Geant"))

    var rsmear=document.createElement("INPUT");
    rsmear.type="checkbox"
    rsmear.id="RunSmear"
    rsmear.name="RunSmear"
    rsmear.value="RunSmear"
    rsmear.checked=true;
    form.appendChild(rsmear);
    form.appendChild(document.createTextNode("Run Smearing"))

    var rrecon=document.createElement("INPUT");
    rrecon.type="checkbox"
    rrecon.id="RunRecon"
    rrecon.name="RunRecon"
    rrecon.value="RunRecon"
    rrecon.checked=true;
    form.appendChild(rrecon);
    form.appendChild(document.createTextNode("Run Reconstruction"))

    form.appendChild(document.createElement("BR"))

    var sgen=document.createElement("INPUT");
    sgen.type="checkbox"
    sgen.id="SaveGeneration"
    sgen.name="SaveGeneration"
    sgen.value="SaveGen"
    form.appendChild(sgen);
    form.appendChild(document.createTextNode("Save Generation"))

    var sgeant=document.createElement("INPUT");
    sgeant.type="checkbox"
    sgeant.id="SaveGeant"
    sgeant.name="SaveGeant"
    sgeant.value="SaveGeant"
    form.appendChild(sgeant);
    form.appendChild(document.createTextNode("Save Geant"))

    var ssmear=document.createElement("INPUT");
    ssmear.type="checkbox"
    ssmear.id="SaveSmear"
    ssmear.name="SaveSmear"
    ssmear.value="SaveSmear"
    form.appendChild(ssmear);
    form.appendChild(document.createTextNode("Save Smearing"))

    var srecon=document.createElement("INPUT");
    srecon.type="checkbox"
    srecon.id="SaveRecon"
    srecon.name="SaveRecon"
    srecon.value="SaveRecon"
    srecon.checked=true;
    form.appendChild(srecon);
    form.appendChild(document.createTextNode("Save Reconstruction"))

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    //ADDITIONAL COMMENTS
    var comlabel=document.createElement("LABEL");
    comlabel.setAttribute("for", "additionalreq");
    comlabel.appendChild(document.createTextNode("Additional Comments:"))
    form.appendChild(comlabel)
    form.appendChild(document.createElement("BR"))
    var addcom=document.createElement("textarea")
    addcom.rows=10;
    addcom.cols=50
    addcom.wrap="soft"
    addcom.id="additionalreq"
    addcom.name="addreq"

    form.appendChild(addcom)

}
function MakeCPPForm()
{
    var form=document.getElementById("expform");
    form.innerHTML=""

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var reclabel=document.createElement("LABEL");
    reclabel.setAttribute("for", "recon_stack");
    reclabel.appendChild(document.createTextNode("halld_recon version:"))
    form.appendChild(reclabel)

    var verFAQ=document.createElement("IMG");
    verFAQ.src="./imgs/q_mark.png"
    verFAQ.style.height='20px'
    verFAQ.style.width='20px'
    verFAQ.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };

    var recselect=document.createElement("SELECT")
    recselect.id="recon_stack"
    recselect.name="halld_recon_ver"
    recselect.setAttribute("onchange","DoSimQuery();MakeCheckButton();");
    form.appendChild(recselect)
    verFAQ2=verFAQ.cloneNode()
    verFAQ2.onclick = function() {
        window.open('https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form',"_blank")
    //window.location.href = 'https://halldweb.jlab.org/wiki/index.php/How_to_choose_software_versions_on_the_MC_submission_form';
    };
    form.appendChild(verFAQ2)
    form.appendChild(document.createElement("BR"))

    var simlabel=document.createElement("LABEL");
    simlabel.setAttribute("for", "sim_ver");
    simlabel.appendChild(document.createTextNode("halld_sim version:"))
    form.appendChild(simlabel)
    var simselect=document.createElement("SELECT")
    simselect.id="sim_ver"
    simselect.name="halld_sim_ver"
    simselect.setAttribute("onchange","DoSetQuery();MakeCheckButton();");
    form.appendChild(simselect)

    form.appendChild(document.createElement("BR"))

    var verlabel=document.createElement("LABEL");
    verlabel.setAttribute("for", "verSet");
    verlabel.appendChild(document.createTextNode("version Set:"))
    form.appendChild(verlabel)
    var verselect=document.createElement("SELECT")
    verselect.id="verSet"
    verselect.name="versionSet"
    verselect.setAttribute("onchange","updatePreview();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(verselect)

    DoReconQuery();

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

//RUN NUMBER/RANGE AND EVENTS
    var Runlabel=document.createElement("LABEL");
    Runlabel.setAttribute("for", "verSet");
    Runlabel.appendChild(document.createTextNode("Run"))
    form.appendChild(Runlabel)
    var runselect=document.createElement("SELECT")
    runselect.id="numOrRange"
    runselect.setAttribute("onchange","updateRangeoptions();MakeCheckButton();");

    var runnum=document.createElement("OPTION");
    runnum.value="Number";
    runnum.text="Number";
    runnum.selected=true;
    runselect.appendChild(runnum)
    var runrange=document.createElement("OPTION");
    runrange.value="Range";
    runrange.text="Range";
    runselect.appendChild(runrange)

    form.appendChild(runselect)

    var runnumlow=document.createElement("INPUT")
    runnumlow.type="number"
    runnumlow.id="runnum"
    runnumlow.name="runnumber"
    runnumlow.placeholder="11366"
    runnumlow.title="Place the desired run number to simulate here"
    runnum.required=true;
    form.appendChild(runnumlow);

    var evtslabel=document.createElement("LABEL");
    evtslabel.setAttribute("for", "numevt");
    evtslabel.id="evtslabel"
    evtslabel.appendChild(document.createTextNode("      Number of Events"))
    form.appendChild(evtslabel)
    var numevts=document.createElement("INPUT")
    numevts.type="number"
    numevts.id="numevt"
    numevts.name="numevents"
    numevts.placeholder="1000000"
    numevts.required=true;
    numevts.title="Integer number representing the total desired events to produce"
    numevts.style.width="20%";
    form.appendChild(numevts);

    //OUTPUT
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var outputlabel=document.createElement("LABEL");
    outputlabel.setAttribute("for", "output");
    outputlabel.appendChild(document.createTextNode("Output Directory Name"))
    form.appendChild(outputlabel)
    var outputloc=document.createElement("INPUT")
    outputloc.type="text"
    outputloc.id="output"
    outputloc.name="outputloc"
    outputloc.placeholder="My_MC"
    outputloc.required=true;
    outputloc.title="The root title of the output directory. NOT the full path. \nNo / allowed (or other special characters)"
    //outputloc.pattern="[^()/><\][\\\x22,;|]+"
    outputloc.style.width="60%";
    form.appendChild(outputloc);
    //GENERATOR
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var genlabel=document.createElement("LABEL");
    genlabel.setAttribute("for", "Generator");
    genlabel.appendChild(document.createTextNode("Generator"))
    form.appendChild(genlabel)
    var genselect=document.createElement("SELECT")
    genselect.id="generator"
    genselect.name="generator"
    genselect.setAttribute("onchange","updateGenConfig();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(genselect)

    populateGenerators("CPP");
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    var genconflabel=document.createElement("LABEL");
    genconflabel.setAttribute("for", "genconfig");
    genconflabel.appendChild(document.createTextNode("Full Path to Generator Config"))
    form.appendChild(genconflabel)
    var genconfloc=document.createElement("INPUT")
    genconfloc.type="text"
    genconfloc.id="genconfig"
    genconfloc.name="generator_config"
    genconfloc.placeholder="/.../Generators/bggen/examples/bggen_config.template"
    genconfloc.required=true;
    genconfloc.title="The full path for the file that configures the above generator. It and the containing directories must be readable and reachable from the interactive farm."
    genconfloc.style.width="60%";
    form.appendChild(genconfloc);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    //PHOTON ENERGIES
    var minElabel=document.createElement("LABEL");
    minElabel.setAttribute("for", "GenMinE");
    minElabel.appendChild(document.createTextNode("Min Photon E:"))
    form.appendChild(minElabel)
    var minEin=document.createElement("INPUT")
    minEin.type="number"
    minEin.step="0.01"
    minEin.id="GenMinE"
    minEin.name="GenMinE"
    minEin.placeholder="3.0 [GeV]"
    minEin.required=true;
    minEin.title="Minimum beam photon energy to simulate rounded to the nearest 10 MeV"
    minEin.style.width="14%";
    form.appendChild(minEin);

    var maxElabel=document.createElement("LABEL");
    maxElabel.setAttribute("for", "GenMaxE");
    maxElabel.appendChild(document.createTextNode("Max Photon E:"))
    form.appendChild(maxElabel)
    var maxEin=document.createElement("INPUT")
    maxEin.type="number"
    maxEin.step="0.01"
    maxEin.id="GenMaxE"
    maxEin.name="GenMaxE"
    maxEin.placeholder="11.6 [GeV]"
    maxEin.required=true;
    maxEin.title="Maximum beam photon energy to simulate rounded to the nearest 10 MeV"
    maxEin.style.width="14%";
    form.appendChild(maxEin);

    form.appendChild(document.createElement("BR"))
    //COHERENT PEAK POSITION
    var cohElabel=document.createElement("LABEL");
    cohElabel.setAttribute("for", "cohPos");
    cohElabel.appendChild(document.createTextNode("Coherent Peak Position"))
    form.appendChild(cohElabel)
    var coherent=document.createElement("INPUT")
    coherent.type="number"
    coherent.step="0.01"
    coherent.id="cohPos"
    coherent.name="cohPos"
    coherent.placeholder="9.0 [GeV]"
    coherent.title="Enter the desired coherent peak position to the nearest 10 GeV.  Note: this overrides the actual value from the chosen run number."
    coherent.style.width="14%";
    form.appendChild(coherent);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    //GEANT VER
    var geantlabel=document.createElement("LABEL");
    geantlabel.setAttribute("for", "Geantver");
    geantlabel.appendChild(document.createTextNode("Geant Version:"))
    form.appendChild(geantlabel)
    var g3in=document.createElement("INPUT");
    g3in.type="radio"
    g3in.id="Geant3"
    g3in.name="Geantver"
    g3in.value="3"
    g3in.checked=false;
    g3in.setAttribute("onclick","MakeCheckButton();");


    form.appendChild(g3in);
    form.appendChild(document.createTextNode("Geant3"))

    var g4in=document.createElement("INPUT");
    g4in.type="radio"
    g4in.id="Geant4"
    g4in.name="Geantver"
    g4in.value="4"
    g4in.checked=true
    g4in.setAttribute("onclick","MakeCheckButton();");

    form.appendChild(g4in);
    form.appendChild(document.createTextNode("Geant4"));

    form.appendChild(document.createElement("BR"));
    //GEANT SECONDARIES
    var geantseclabel=document.createElement("LABEL");
    geantseclabel.setAttribute("for", "Geantver");
    geantseclabel.appendChild(document.createTextNode("Geant Secondaries?"))
    form.appendChild(geantseclabel)
    var gsecin=document.createElement("INPUT");
    gsecin.type="checkbox"
    gsecin.id="GeantSecondaries"
    gsecin.name="GeantSecondaries"
    gsecin.value="GeantSecondaries"
    gsecin.checked=true;

    form.appendChild(gsecin);

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //BACKGROUNDS
    var bkglabel=document.createElement("LABEL");
    bkglabel.setAttribute("for", "bkgconf");
    bkglabel.appendChild(document.createTextNode("Background:"))
    form.appendChild(bkglabel)
    var bkgselect=document.createElement("SELECT")
    bkgselect.id="bkg"
    bkgselect.name="bkg"
    bkgselect.setAttribute("onchange","updateBKGoptions();MakeCheckButton();");
    //verselect.onchange="updatePreview();MakeCheckButton()"
    form.appendChild(bkgselect)

    populateBackgrounds("CPP");

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    ana_br_anchor=document.createElement("BR")
    ana_br_anchor.id="Ana_Anchor"
    form.appendChild(ana_br_anchor)
    //REACTION FILTER
    AnalysisFormModule(form)

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))
    //Runnings boxes

    var rgen=document.createElement("INPUT");
    rgen.type="checkbox"
    rgen.id="RunGeneration"
    rgen.name="RunGeneration"
    rgen.value="RunGen"
    rgen.checked=true;
    form.appendChild(rgen);
    form.appendChild(document.createTextNode("Run Generation"))

    var rgeant=document.createElement("INPUT");
    rgeant.type="checkbox"
    rgeant.id="RunGeant"
    rgeant.name="RunGeant"
    rgeant.value="RunGeant"
    rgeant.checked=true;
    form.appendChild(rgeant);
    form.appendChild(document.createTextNode("Run Geant"))

    var rsmear=document.createElement("INPUT");
    rsmear.type="checkbox"
    rsmear.id="RunSmear"
    rsmear.name="RunSmear"
    rsmear.value="RunSmear"
    rsmear.checked=true;
    form.appendChild(rsmear);
    form.appendChild(document.createTextNode("Run Smearing"))

    var rrecon=document.createElement("INPUT");
    rrecon.type="checkbox"
    rrecon.id="RunRecon"
    rrecon.name="RunRecon"
    rrecon.value="RunRecon"
    rrecon.checked=true;
    form.appendChild(rrecon);
    form.appendChild(document.createTextNode("Run Reconstruction"))

    form.appendChild(document.createElement("BR"))

    var sgen=document.createElement("INPUT");
    sgen.type="checkbox"
    sgen.id="SaveGeneration"
    sgen.name="SaveGeneration"
    sgen.value="SaveGen"
    form.appendChild(sgen);
    form.appendChild(document.createTextNode("Save Generation"))

    var sgeant=document.createElement("INPUT");
    sgeant.type="checkbox"
    sgeant.id="SaveGeant"
    sgeant.name="SaveGeant"
    sgeant.value="SaveGeant"
    form.appendChild(sgeant);
    form.appendChild(document.createTextNode("Save Geant"))

    var ssmear=document.createElement("INPUT");
    ssmear.type="checkbox"
    ssmear.id="SaveSmear"
    ssmear.name="SaveSmear"
    ssmear.value="SaveSmear"
    form.appendChild(ssmear);
    form.appendChild(document.createTextNode("Save Smearing"))

    var srecon=document.createElement("INPUT");
    srecon.type="checkbox"
    srecon.id="SaveRecon"
    srecon.name="SaveRecon"
    srecon.value="SaveRecon"
    srecon.checked=true;
    form.appendChild(srecon);
    form.appendChild(document.createTextNode("Save Reconstruction"))

    form.appendChild(document.createElement("BR"))
    form.appendChild(document.createElement("BR"))

    //ADDITIONAL COMMENTS
    var comlabel=document.createElement("LABEL");
    comlabel.setAttribute("for", "additionalreq");
    comlabel.appendChild(document.createTextNode("Additional Comments:"))
    form.appendChild(comlabel)
    form.appendChild(document.createElement("BR"))
    var addcom=document.createElement("textarea")
    addcom.rows=10;
    addcom.cols=50;
    addcom.wrap="soft"
    addcom.id="additionalreq"
    addcom.name="addreq"

    form.appendChild(addcom)
}
function updateANA(preRL)
{
    var sel=document.getElementById("ANAStyle");
    var sel_val=sel.value;

    if(sel_val=="ReactionFilter")
    {
        if(document.getElementById("ReactionLines"))
        {
           removeElementByID("ReactionLines")
        }

        var rfin=document.createElement("INPUT");
        rfin.type="button"
        rfin.id="ReactionFilter"
        rfin.name="ReactionFilter"
        rfin.value="Add Reactions"
        rfin.setAttribute("onclick","GetReactions();MakeCheckButton();");
        sel.parentNode.insertBefore(rfin,sel.nextSibling);

        var rltext=document.createElement("textarea")
        rltext.id="ReactionLines"
        rltext.name="ReactionLines"
        rltext.readOnly=true;
        rltext.className="hidden"
        rfin.parentNode.insertBefore(rltext,rfin.nextSibling);
    }
    else if(sel_val=="JanaConfig")
    {
        if(document.getElementById("ReactionFilter"))
        {
            removeElementByID("ReactionFilter")
        }

        if(document.getElementById("ReactionLines"))
        {
           removeElementByID("ReactionLines")
        }

        var config_path=document.createElement("INPUT")
        config_path.type="text"
        config_path.id="ReactionLines"
        config_path.name="ReactionLines"
        config_path.required=true;
        config_path.setAttribute("onchange","MakeCheckButton();");
        if(preRL!="")
        {
            config_path.value=preRL
        }
        sel.parentNode.insertBefore(config_path,sel.nextSibling);

    }
    addANAselector()
}
function AnalysisFormModule(form)
{
    anchor=document.getElementById("Ana_Anchor")

    ana_style_selector=document.createElement("SELECT")
    ana_style_selector.id="ANAStyle"
    ana_style_selector.name="ANAStyle"
    MakeOption(ana_style_selector,"ReactionFilter",1)
    MakeOption(ana_style_selector,"JanaConfig",0)
    ana_style_selector.setAttribute("onchange","updateANA('');MakeCheckButton();");
    //var rflabel=document.createElement("LABEL");
    //rflabel.setAttribute("for", "ReactionFilter");
    //rflabel.appendChild(document.createTextNode("Reaction Filter"))
    anchor.parentNode.insertBefore(ana_style_selector,anchor.nextSibling);

    updateANA('')


}
function updateGenFluxOptions()
{
    var selccdb=document.getElementById("ccdb_flux");
    var selccdb_val=document.getElementById("ccdb_flux").checked;

    var selcobrems=document.getElementById("cobrems_flux");
    var selcobrems_val=document.getElementById("cobrems_flux").checked;


    if(selcobrems_val)
    {
        console.log("MAKE THE COH PEAK")
    }
    else
    {
        console.log("DESTROY THE COH PEAK")
    }
    return
}
function MakeCheckButton()
    {
        if(document.getElementById("prefill").value != "-1" && document.getElementById("mod").value != "2" )
        {
            return
        }

        buttoncont=document.getElementById("submitbutton");
        confirmbtn=document.getElementById("Submit");
        if(confirmbtn)
        {
            buttoncont.removeChild(confirmbtn)
        }

        if(!document.getElementById("Query"))
        {
            newbutton=document.createElement("INPUT");
            var text=document.createTextNode("Confirm");
            newbutton.appendChild(text);
            newbutton.type="button";
            newbutton.id="Query"
            newbutton.addEventListener('click', function() {
            DoCheck();
                }, false);
            newbutton.value="Confirm";
            newbutton.className="Confirm"

            buttoncont.appendChild(newbutton);
        }
    }
    function DoCheck()
    {

        if(document.getElementById("output").value.split("/").length-1 > 1)
        {
            alert("THE OUTPUT DIRECTORY NAME IS JUST THE NAME. NOT THE PATH.  PLEASE CHOOSE ANOTHER NAME")
            document.getElementById("output").value="";
            return;
        }

        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                console.log(this.responseText)
                result=JSON.parse(this.responseText);

                console.log(result)
                if(result.length!=0)
                {
                    message="I found "+result.length+" MC requests on file matching the requested version Set, generator, and background.\n\nTheir Project IDs are: \n"

                    for(var i=0;i<result.length;i++)
                    {
                        message=message+result[i].ID+", "
                    }
                    message = message.substring(0, message.length - 2);
                    message=message+"\n\n Please check to see if these samples would be usable by looking in MCWrapper Records.\nIf not please confirm the request."
                    if(window.confirm(message))
                    {
                        MakeSubmitButton();
                    }
                }
                else{
                    MakeSubmitButton();
                }
                }

            }

            var generator_name=$("#generator option:selected")[0].value
            var selected_version=$("#verSet option:selected")[0].value
            var selected_background=$("#bkg option:selected")[0].value

            var chosen_randomtag=""
            var randomtag_ele=document.getElementById("randomtag")
            if(randomtag_ele)
            {
                chosen_randomtag=randomtag_ele.value;
            }



        console.log("./php/checkForMC.php?generator="+generator_name+"&versionSet="+selected_version+"&bkg="+selected_background+"&randomtag="+chosen_randomtag)
        xmlhttp.open("GET","./php/checkForMC.php?generator="+generator_name+"&versionSet="+selected_version+"&bkg="+selected_background+"&randomtag="+chosen_randomtag);


        xmlhttp.send();


    }
    function MakeUpdateButton()
    {
        buttoncont=document.getElementById("submitbutton");
        confirmbtn=document.getElementById("Query");
        if(confirmbtn)
        {
            buttoncont.removeChild(confirmbtn)
        }

        newbutton=document.createElement("INPUT");
        var text=document.createTextNode("Confirm");
        newbutton.appendChild(text);
        newbutton.type="submit";
        newbutton.id="Update"

        newbutton.value="Update";
        newbutton.className="Update"

        buttoncont.appendChild(newbutton);
    }
    function MakeSubmitButton()
    {
        buttoncont=document.getElementById("submitbutton");
        confirmbtn=document.getElementById("Query");
        if(confirmbtn)
        {
            buttoncont.removeChild(confirmbtn)
        }

        newbutton=document.createElement("INPUT");
        var text=document.createTextNode("Confirm");
        newbutton.appendChild(text);
        newbutton.type="submit";
        newbutton.id="Submit"

        newbutton.value="Submit";
        newbutton.className="Submit"

        buttoncont.appendChild(newbutton);
    }
function GetReactions()
{

    popup=window.open("./ReactionFilterLines.html", "popupwindow", 'width=800,height=600');


    popup.onload = function()
    {
        setTimeout(function(){ console.log(popup.document.getElementById("collection")); }, 500);
    }
    popup.onbeforeunload = function(){lines=popup.document.getElementById("collection");console.log(lines);MakeLines(lines);}


}
function MakeLines(lines)
    {

        if(document.getElementById("ANAStyle").value=="ReactionFilter")
        {
            document.getElementById("ReactionLines").value="";
            if(lines.children.length > 0)
            {
                for(var i=0;i<lines.children.length;i++)
                {
                    if(lines.children[i].nodeName!="SPAN")
                        continue;

                    document.getElementById("ReactionLines").value+=lines.children[i].children[1].value+'\n';
                    document.getElementById("ReactionFilter").value="Reactions Set";
                    document.getElementById("ReactionLines").style.visibility="visible"
                    document.getElementById("ReactionLines").className="fadeInLeft-vis";

                }

            }
            else
            {
                document.getElementById("ReactionFilter").value="Add Reactions";
                document.getElementById("ReactionLines").style.visibility="hidden"
                document.getElementById("ReactionLines").className="";
            }
            addANAselector();
        }
        else
        {
            addANAselector();
        }



    }
function populateGenerators(exp)
{
    var gensel=document.getElementById("generator");
    var Gens= ["file:"];
    var defgen="file:"

    if(exp=="CPP")
    {
        defgen="gen_2pi_primakoff"
        Gens=["genr8","bggen","gen_2pi_amp","gen_2pi_primakoff","gen_pi0","particle_gun","gen_amp","gen_omegapi"]//,"file:"]
    }
    else if(exp=="JEF")
    {
        defgen="genEtaRegge"
        Gens=["genr8","bggen","gen_amp","genEtaRegge"]//,"file:"]
    }
    else
    {
        defgen="bggen"
        Gens = ["genr8","bggen","genEtaRegge","gen_2pi_primakoff","gen_pi0","bggen_jpsi","bggen_upd","gen_ee","gen_ee_hb","bggen_phi_ee","particle_gun","genBH","gen_amp","gen_omegapi","mc_gen","geantBEAM","gen_vec_ps"]//,"file:"]
        //Gens = ["genr8","bggen","genEtaRegge","gen_2pi_amp","gen_2pi_primakoff","gen_pi0","gen_omega_3pi","gen_2k","bggen_jpsi","bggen_upd","gen_ee","gen_ee_hb","bggen_phi_ee","particle_gun","genBH","gen_omega_radiative","gen_amp","file:"]
    }

    Gens.forEach(function(element) {
        var sel=false;
        if(element==defgen)
        {
            sel=true;
        }

        MakeOption(gensel,element,sel)
        });
}

function addANAselector()
{
    var sel=document.getElementById("ReactionLines");
    if (sel.value != "" && document.getElementById("ANAStyle").value == "ReactionFilter" && !document.getElementById("anaverSet"))
    {
        //console.log("build ana set")
        var anaverselect=document.createElement("SELECT");
        anaverselect.id="anaverSet";
        anaverselect.name="anaverSet"
        anaverselect.setAttribute("onchange","updatePreview();MakeCheckButton();");
        //verselect.onchange="updatePreview();MakeCheckButton()"
        //form.appendChild(anaverselect)
        sel.parentNode.insertBefore(anaverselect,sel.nextSibling)
        var anaverlabel=document.createElement("LABEL");
        anaverlabel.setAttribute("for", "anaverSet");
        anaverlabel.id="anaverlabel"
        anaverlabel.appendChild(document.createTextNode("analysis version Set:"))
        //form.appendChild(anaverlabel)
        sel.parentNode.insertBefore(anaverlabel,sel.nextSibling)

        var ananamedbr=document.createElement("BR");
        ananamedbr.id="anaverbr";
        sel.parentNode.insertBefore(ananamedbr,sel.nextSibling);
        DoANASetQuery();
    }
    else if (sel.value != "" && document.getElementById("ANAStyle").value == "ReactionFilter" && document.getElementById("anaverSet"))
    {
        DoANASetQuery();
    }
    else if(document.getElementById("ANAStyle").value == "JanaConfig" && !document.getElementById("anaverSet"))
    {
        var anaverselect=document.createElement("SELECT");
        anaverselect.id="anaverSet";
        anaverselect.name="anaverSet"
        anaverselect.setAttribute("onchange","updatePreview();MakeCheckButton();");
        //verselect.onchange="updatePreview();MakeCheckButton()"
        //form.appendChild(anaverselect)
        sel.parentNode.insertBefore(anaverselect,sel.nextSibling)
        var anaverlabel=document.createElement("LABEL");
        anaverlabel.setAttribute("for", "anaverSet");
        anaverlabel.id="anaverlabel"
        anaverlabel.appendChild(document.createTextNode("analysis version Set:"))
        //form.appendChild(anaverlabel)
        sel.parentNode.insertBefore(anaverlabel,sel.nextSibling)

        var ananamedbr=document.createElement("BR");
        ananamedbr.id="anaverbr";
        sel.parentNode.insertBefore(ananamedbr,sel.nextSibling);
        DoANASetQuery();
    }
    else
    {
        if(document.getElementById("anaverSet"))
        {
            removeElementByID("anaverSet");
        }
        if(document.getElementById("anaverlabel"))
        {
            removeElementByID("anaverlabel");
        }
        if(document.getElementById("anaverbr"))
        {
            removeElementByID("anaverbr");
        }

    }
}
function updateGenPost()
{
    
    var genPost_sel=document.getElementById("GenPost");
    var genPost_sel_val=genPost_sel.value;
    removeChildrenBetween("GenPost","geant_br_anchor")
    if(genPost_sel_val=="decay_evtgen")
    {
        
        var geant_br_anchor=document.getElementById("geant_br_anchor");
        var anchor_br=document.createElement("BR")
        geant_br_anchor.parentNode.insertBefore(anchor_br,geant_br_anchor)
        

        var genpostf1label=document.createElement("LABEL");
        genpostf1label.setAttribute("for", "f1_input");
        genpostf1label.appendChild(document.createTextNode("decay_evtgen Config:"))

        var f1_input=document.createElement("INPUT");
        f1_input.setAttribute("type","text");
        f1_input.id="f1_input";
        f1_input.name="f1_input";
        f1_input.placeholder="Default"
        geant_br_anchor.parentNode.insertBefore(genpostf1label,geant_br_anchor)
        geant_br_anchor.parentNode.insertBefore(f1_input,geant_br_anchor)


        var genpostf2label=document.createElement("LABEL");
        genpostf2label.setAttribute("for", "f2_input");
        genpostf2label.appendChild(document.createTextNode(", (optional) pdl:"))

        var f2_input=document.createElement("INPUT");
        f2_input.setAttribute("type","text");
        f2_input.id="f2_input";
        f2_input.name="f2_input";
        f2_input.placeholder="Default"
        geant_br_anchor.parentNode.insertBefore(genpostf2label,geant_br_anchor)
        geant_br_anchor.parentNode.insertBefore(f2_input,geant_br_anchor)

        var genpostf3label=document.createElement("LABEL");
        genpostf3label.setAttribute("for", "f3_input");
        genpostf3label.appendChild(document.createTextNode(", (optional) dec:"))

        var f3_input=document.createElement("INPUT");
        f3_input.setAttribute("type","text");
        f3_input.id="f3_input";
        f3_input.name="f3_input";
        f3_input.placeholder="Default"
        geant_br_anchor.parentNode.insertBefore(genpostf3label,geant_br_anchor)
        geant_br_anchor.parentNode.insertBefore(f3_input,geant_br_anchor)

    }


}
function updateBKGoptions()
    {
        var sel=document.getElementById("bkg");
        var sel_val=document.getElementById("bkg").value;

        if(sel_val != "None")
        {
            if(document.getElementById("randomtag")==null)
            {
                var randomtag=document.createElement("Input")
                randomtag.id="randomtag"
                randomtag.name="randomtag"
                sel.parentNode.insertBefore(randomtag,sel.nextSibling)


            }
        }

        if(sel_val==="Random")
        {
            var randomtag=document.createElement("SELECT")
            randomtag.id="randomtag"
            randomtag.name="randomtag"
            document.getElementById("randomtag").replaceWith(randomtag)

            document.getElementById("randomtag").style.width="38%"
            randtags=["recon-2017_01-ver03.2","recon-2018_01-ver02.2","recon-2018_08-ver02.2","recon-2019_01-ver01","recon-2019_11-ver01","workfest2018_baseline","offmon-2018_01-ver11","offmon-2018_08-ver07"]

            randtags.forEach(function(element) {
                halld_reconVer=document.getElementById("recon_stack")

                selectedVer=""
                if(halld_reconVer.selectedIndex >= 0)
                {
                    selectedVer=halld_reconVer.options[halld_reconVer.selectedIndex].value
                }

                var found=false
                var sel=false;
                if(selectedVer.includes(element) && !found)
                {
                    sel=true;
                    found=true
                }

                MakeOption(document.getElementById("randomtag"),element,sel)
            });

            if(document.getElementById("randomtag").selectedIndex==-1)
            {
                document.getElementById("randomtag").selectedIndex=0;
            }
            //document.getElementById("randomtag").placeholder="sim-recon tag. e.g recon-2017_01-ver02";
            //document.getElementById("randomtag").title="place a github tag here that corresponds to the reconstruction tag used in producing the random triggers"
            //document.getElementById("randomtag").pattern="[^' ']+"
            document.getElementById("randomtag").required=true;
        }
        else if(sel_val==="BeamPhotons" || sel_val==="TagOnly")
        {
            var randomtag=document.createElement("INPUT")
            randomtag.id="randomtag"
            randomtag.name="randomtag"
            document.getElementById("randomtag").replaceWith(randomtag)

            document.getElementById("randomtag").style.width="20%"
            document.getElementById("randomtag").placeholder="optional: .12345 [GHz]";
            document.getElementById("randomtag").title="The rate desired in GhZ.  If no rate is given one will be calculated based on the other parameters of the run."

        }
        else if(sel_val==="Random loc:/")
        {
            var randomtag=document.createElement("INPUT")
            randomtag.id="randomtag"
            randomtag.name="randomtag"
            document.getElementById("randomtag").replaceWith(randomtag)

            document.getElementById("randomtag").style.width="50%"
            document.getElementById("randomtag").placeholder="full path to folder containing the random trigger files";
            document.getElementById("randomtag").title="the full path to a folder containing random trigger files of the form runXXXXXX_random.hddm"
            document.getElementById("randomtag").required=true;
        }
        else
        {
            if(document.getElementById("randomtag"))
            {
                removeElementByID("randomtag");
            }
        }
}
function populateGenPost(exp)
{
    var genpost=document.getElementById("GenPost");
    var post_options=["None","decay_evtgen"]
    post_options.forEach(function(element) {
        var sel=false;
        if(element=="None")
        {
            sel=true;
        }
        MakeOption(genpost,element,sel)
    });

}
function populateBackgrounds(exp)
{
    var bkgsel=document.getElementById("bkg");
    var bkgs= ["None"];
    var defbkg="None"

    if(exp=="CPP")
    {
        bkgs=["None","Random","Random loc:/","BeamPhotons","TagOnly"]
    }
    else if(exp=="JEF")
    {
        bkgs=["None","Random","Random loc:/","BeamPhotons","TagOnly"]
    }
    else
    {
        bkgs=["None","Random","Random loc:/","BeamPhotons","TagOnly"]
    }

    bkgs.forEach(function(element) {
        var sel=false;
        if(element==defbkg)
        {
            sel=true;
        }

        MakeOption(bkgsel,element,sel)
        });
}
function MakeOption(selector,val,selected)
{
    if(selector)
    {
    var opt=document.createElement("OPTION");
    opt.value=val;
    opt.text=val;
    if(selected)
    {
        opt.selected=true;
    }
    selector.appendChild(opt)

    }


}
function updateGenConfig()
{
    if($("#generator option:selected")[0].value == "file:")
    {
        document.getElementById("genconfig").placeholder="full path to hddm file to use as input to geant";
    }
    else
    {
        document.getElementById("genconfig").placeholder="/u/home/Generators/bggen/examples/bggen_config.template";
    }
}
function removeElementByID(id)
{
    if(document.getElementById(id))
    {
        var el=document.getElementById(id)
        el.parentNode.removeChild(el);
    }
}
function removeChildrenBetween(start,end)
{
    var startel=document.getElementById(start)
    var endel=document.getElementById(end)

    if(startel ==null || endel ==null)
    {
        return;
    }
    var parent=startel.parentNode;
    while(startel.nextSibling!=endel)
    {
        parent.removeChild(startel.nextSibling);
    }
}
function updateRangeoptions()
    {

        var form=document.getElementById("expform");
        var sel_val=document.getElementById("numOrRange").value;

        if(sel_val==="Number")
        {
            var anchor=document.getElementById("runnum");
            anchor.title="Place the desired run number to simulate here";
            var numevts=document.getElementById("numevt");
            numevts.title="Integer number representing the total desired events to produce.\nNote: because events are generated in proporition to events taken and non integers values are not possible then this is only an approximate value"

            if(document.getElementById("maxRunNum")){
                document.getElementById("maxrunrange").value=document.getElementById("maxRunNum").value
            }
            if(document.getElementById("rcdbq")){
                document.getElementById("savedrcdbquery").value=document.getElementById("rcdbq").value
                if(document.getElementById("rcdbq").hasAttribute("readonly"))
                    document.getElementById("savedrcdbquery").setAttribute("readonly","")
            }
            removeElementByID("dash")
            removeElementByID("rcdbbr")
            removeElementByID("rcdbbr2")
            removeElementByID("maxRunNum")
            removeElementByID("rcdbL")
            removeElementByID("rcdbq")
            removeElementByID("RCDBFAQ")
        }
        else if(sel_val==="Range")
        {
            var numevts=document.getElementById("numevt");
            numevts.title="Integer number representing the total desired events to produce"

            var anchor=document.getElementById("runnum");
            anchor.title="Place the lower run number of the range here"

            var runnumhigh=document.createElement("INPUT")
            runnumhigh.type="number"
            runnumhigh.id="maxRunNum"
            runnumhigh.name="maxRunNum"
            runnumhigh.title="Place the upper run number of the range here"
            runnumhigh.placeholder="11555"
            runnumhigh.required=true;
            runnumhigh.value=document.getElementById("maxrunrange").value
            //form.appendChild(runnumhigh);

            anchor.parentNode.insertBefore(runnumhigh,anchor.nextSibling)

            var dash=document.createElement("text");
            dash.id="dash"
            dash.innerHTML="-"
            dash.style.fontSize="25pt"
            anchor.parentNode.insertBefore(dash,anchor.nextSibling);

            var numevt_anchor=document.getElementById("evtslabel");
            var namedbr=document.createElement("BR")
            namedbr.id="rcdbbr"

            numevt_anchor.parentNode.insertBefore(namedbr,numevt_anchor)

            var rcdblabel=document.createElement("LABEL");
            rcdblabel.id="rcdbL"
            rcdblabel.setAttribute("for", "rcdbq");
            rcdblabel.appendChild(document.createTextNode("RCDB Query"))

            namedbr.parentNode.insertBefore(rcdblabel,namedbr.nextSibling)

            var rcdbq=document.createElement("INPUT")
            rcdbq.type="text"
            rcdbq.id="rcdbq"
            rcdbq.name="rcdbq"
            rcdbq.placeholder="optional Default: @is_(2018)production and @status_approved"
            rcdbq.style.width="75%";
            rcdbq.value=document.getElementById("savedrcdbquery").value
            if(document.getElementById("savedrcdbquery").hasAttribute("readonly"))
                rcdbq.setAttribute("readonly","")

            rcdblabel.parentNode.insertBefore(rcdbq,rcdblabel.nextSibling)

            var RCDBFAQ=document.createElement("IMG");
                RCDBFAQ.id="RCDBFAQ"
                RCDBFAQ.src="./imgs/q_mark.png"
                RCDBFAQ.style.height='20px'
                RCDBFAQ.style.width='20px'
                RCDBFAQ.onclick = function() {
                    window.open('https://halldweb.jlab.org/wiki-private/index.php/GlueX_Phase-I_Dataset_Summary',"_blank")
                //window.location.href = 'https://halldweb.jlab.org/wiki-private/index.php/GlueX_Phase-I_Dataset_Summary';
                };

            rcdbq.parentNode.insertBefore(RCDBFAQ,rcdblabel.nextSibling)

            var namedbr2=document.createElement("BR")
            namedbr2.id="rcdbbr2"

            rcdbq.parentNode.insertBefore(namedbr2,rcdbq.nextSibling)


        }

    }

function PopulateVer(id,result)
{
    reconSel=document.getElementById(id)
    removeOptions(reconSel)

    for(var i=0;i<result.length;i++)
    {

        if(id=="verSet" && result[i].version=="version_4.45.1.xml")
        {
            continue
        }

        var newoption = document.createElement("option");



        if(!result[i].version && id != "anaverSet")
        {
            newoption.text = "master";
            newoption.value = "master";
        }
        else if(result[i].version=="master" && id == "anaverSet")
        {
            console.log(result[i])
            continue;
        }
        else
        {
            newoption.text = result[i].version;
            newoption.value = result[i].version;
        }



        reconSel.add(newoption);

        if ((id == "recon_stack" && newoption.text=="recon-2017_01-ver03_hdr") || (id == "sim_ver" && newoption.text=="4.2.0") || (id == "anaverSet" && newoption.text=="None") )
        {
            newoption.selected=true;
        }
        else if(i==0)
        {
            newoption.selected=true;
        }
    }
}
function removeOptions(selectbox)
{
    if(selectbox)
    {
        for(var i = selectbox.options.length - 1 ; i >= 0 ; i--)
        {
            selectbox.remove(i);
        }
    }
}
function updatePreview()
{
    rightDIV=document.getElementById("Info-pane");

    if(firstLoad==false)
    {

        rightDIV.style.animationName="bounceOutDown";

    }
    else
    {
        firstLoad=false;
    }
    //

   // window.setTimeout(2005);

    var e = document.getElementById("verSet");
    var selSet = e.options[e.selectedIndex].text;

    document.getElementById("setpreview").className="run-bounceInDown"
    rightDIV.style.animationName="bounceInDown";
    rightDIV.className="run-bounceInDown"
    document.getElementById("setpreview").data="https://halldweb.jlab.org/halld_versions/"+selSet;

}
function DoReconQuery()
    {
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                result=JSON.parse(this.responseText);

                console.log(result)
                PopulateVer("recon_stack",result)
                if(document.getElementById("prefill").value != "-1" )
                {
                    if(project.recon_ver == null)
                    {
                        MakeSelectedByValue(document.getElementById("recon_stack"),"master")
                    }
                    else
                    {
                        MakeSelectedByValue(document.getElementById("recon_stack"),project.recon_ver)
                    }

                }
                DoSimQuery()

                }

            }
            query_to_do="SELECT DISTINCT"

        console.log("./php/versionFinder.php?recon_ver=unknown&sim_ver=unknown")
        xmlhttp.open("GET","./php/versionFinder.php?recon_ver=unknown&sim_ver=unknown");


        xmlhttp.send();
}
function DoSimQuery()
    {
        var e = document.getElementById("recon_stack");
        var selRecon = e.options[e.selectedIndex].value;


        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                result=JSON.parse(this.responseText);

                console.log(result)
                PopulateVer("sim_ver",result)

                if(document.getElementById("prefill").value != "-1" )
                {
                MakeSelectedByValue(document.getElementById("sim_ver"),project.sim_ver)
                }
                DoSetQuery()

                }

            }
            query_to_do="SELECT DISTINCT"


        console.log("./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver=unknown")
        xmlhttp.open("GET","./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver=unknown");


        xmlhttp.send();
}
function DoSetQuery()
    {
        var recons = document.getElementById("recon_stack");
        var selRecon = recons.options[recons.selectedIndex].value;

        var sims = document.getElementById("sim_ver");
        var selSim = sims.options[sims.selectedIndex].value;

        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                result=JSON.parse(this.responseText);

                console.log(result)
                PopulateVer("verSet",result)
                if(document.getElementById("prefill").value != "-1" )
                {

                MakeSelectedByValue(document.getElementById("verSet"),project.VersionSet)
                }

                updatePreview();
                if(document.getElementById("ReactionLines").value != "" && document.getElementById("prefill").value != "-1" && !document.getElementById("anaverSet"))
                {
                addANAselector()
                //MakeSelectedByValue(document.getElementById("anaverSet"),result.ANAVersionSet)
                }
                else if(document.getElementById("anaverSet"))
                {
                    DoANASetQuery();
                }
                }

            }
            query_to_do="SELECT DISTINCT"


        console.log("./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver="+selSim)
        xmlhttp.open("GET","./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver="+selSim);


        xmlhttp.send();
}
function DoANASetQuery()
    {
        var recons = document.getElementById("recon_stack");
        if(recons.selectedIndex != -1)
        {

        var selRecon = recons.options[recons.selectedIndex].value;

        var sims = document.getElementById("sim_ver");
        var selSim = sims.options[sims.selectedIndex].value;

        var vers = document.getElementById("verSet");
        var selVer = vers.options[vers.selectedIndex].value;

        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {

                result=JSON.parse(this.responseText);

                console.log(result)
                PopulateVer("anaverSet",result)
                if(document.getElementById("prefill").value != "-1" )
                {

                MakeSelectedByValue(document.getElementById("anaverSet"),project.ANAVersionSet)
                }

                updatePreview();

                }

            }
            query_to_do="SELECT DISTINCT"


        console.log("./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver="+selSim+"&verSet="+selVer)
        xmlhttp.open("GET","./php/versionFinder.php?recon_ver="+selRecon+"&sim_ver="+selSim+"&verSet="+selVer);


        xmlhttp.send();
        }
        else{
        setTimeout(DoANASetQuery,1000)

        }
}
</script>
</html>
